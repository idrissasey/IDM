/*
 * generated by Xtext 2.12.0
 */
package org.xtext.example.mydsl.generator

import org.eclipse.emf.ecore.resource.Resource
import org.eclipse.xtext.generator.AbstractGenerator
import org.eclipse.xtext.generator.IFileSystemAccess2
import org.eclipse.xtext.generator.IGeneratorContext
import idm.tp1.StateMachine
import idm.tp1.State
import idm.tp1.Transition

/**
 * Generates code from your model files on save.
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#code-generation
 */
class MyDslGenerator extends AbstractGenerator {

	override void doGenerate(Resource resource, IFileSystemAccess2 fsa, IGeneratorContext context) {
		var mysm = resource.contents.get(0) as StateMachine
		mysm.state.forEach[s | fsa.generateFile("../src/Concrete/"+s.name+".java", s.print)]
		mysm.transition.forEach[t | fsa.generateFile("../src/Concrete/"+t.name+".java", t.print)]
		
		fsa.generateFile("../src/Abstract/Transition.java", printAbstractTransition())
		
		fsa.generateFile("../src/Abstract/State.java", printAbstractState())
		
		fsa.generateFile("../src/Concrete/ProgramPrincipal.java", printMain())
	}
	
	def printMain() {
		'''
		package Concrete;
		
		import Abstract.*;
		
		
		public class ProgramPrincipal {
		
			public static void main(String[] args) {
				Down d = new Down();
			}
		}
		
		'''
	}
	
	def print(State s) {
		'''
		package Concrete;
		
		import Abstract.*;
		
		class «s.name» extends State{
			
			Transition outgoing;
			Transition incoming;
			
			boolean current = false;
			
			
			public «s.name»(){
				
			}			
			
			public «s.name»(Transition outgoing, Transition incoming, boolean current) {
				this.outgoing = outgoing;
				this.incoming = incoming;
				this.current = current;
			}
			public boolean getCurrent(){
				return this.current;
			}
			
			public void setCurrent(boolean value){
				this.current = value;
				}
		}
		
		'''
	}
	
	
	
	def print(Transition t) {
				'''
		package Concrete;
		
		import Abstract.*;
		
		class «t.name» extends Transition{
			
			State from;
			State to;
						
			public «t.name»(State from, State to) {
				this.to = to;
				this.from= from;
			}
		}
		
		'''
	}
	def printAbstractTransition(){
		'''
		package Abstract;
		
		public abstract class Transition {}
		'''
	}
	
	def printAbstractState(){
		'''
		package Abstract;
		
		public abstract class State {
			private boolean current;
			
			public boolean getCurrent(){};
			public void setCurrent(boolean value){return false;};
			
		}
		'''
	}
}
